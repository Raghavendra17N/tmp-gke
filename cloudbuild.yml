steps:
  - name: 'gcr.io/cloud-builders/gcloud'
    entrypoint: 'bash'
    args:
    - '-c'
    - |
        apt-get install openjdk-11-jdk
        apt install maven
        gcloud auth configure-docker -q
        cd spring-petclinic
        chmod +x
        ./mvnw clean install
        cd spring-petclinic-server
        mvn clean package docker:build

  - name: 'gcr.io/cloud-builders/docker'
    entrypoint: 'sh'
    args:
    - '-c'
    - |
       docker tag springboot-petclinic-actions gcr.io/$PROJECT_ID/springboot-petclinic-actions:$SHORT_SHA
       docker push gcr.io/$PROJECT_ID/springboot-petclinic-actions:$SHORT_SHA
